<!-- kanban.component.html -->
<div class="kanban-board" cdkDropListGroup *ngIf="!type">
  <ng-container *ngFor="let column of data">
    <div [style.width.%]="!column?.collapsed? (100 / data.length): 10" class="kanban-column">
      <div class="kanban-column-header">
        <h2 [class.collapsed]="column?.collapsed">
          <span *ngIf="!column?.collapsed">{{ column.heading }}</span>

          <span class="expand-icon" *ngIf="column?.toggleColumn" [class.icon_center]="column?.collapsed"
            (click)="toggleCollapse(column)">
            <!-- Custom symbols for expand and collapse -->
            <ng-container *ngIf="!column?.collapsed; else collapsedIcon">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                fill="#5f6368">
                <path d="M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z" />
              </svg>
            </ng-container>
            <ng-template #collapsedIcon>
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                fill="#5f6368">
                <path d="m321-80-71-71 329-329-329-329 71-71 400 400L321-80Z" />
              </svg>
            </ng-template>
          </span>
        </h2>
      </div>

      <div class="kanban-column-data">
        <div *ngIf="column?.collapsed" class="vertical-writing">
          [{{column.tasks?.length}}] {{column.heading}}
        </div>
        <div cdkDropList [cdkDropListData]="column.tasks" class="kanban-list" #kanbanList
          (cdkDropListDropped)="drop($event)" *ngIf="!column?.collapsed">
          <div class="kanban-item" *ngFor="let task of column.tasks" cdkDrag
            [style.borderTop]="task?.borderColor ? '3px solid ' + task?.borderColor : ''">
            <div class="task-card">
              <!-- Header -->
              <div class="task-header" *ngIf="task.header?.length">
                <ng-container *ngFor="let item of task.header">
                  <ng-container *ngIf="item.type === 'link'">
                    <span class="link">
                      <a href="javascript:void(0)" (click)="addAction($event, item)">{{ item.label }}</a>
                    </span>
                  </ng-container>
                  <ng-container *ngIf="item.type === 'chip'">
                    <span class="chip-container">
                      <span *ngFor="let chip of item.value" class="chip" [style.backgroundColor]="chip?.backgroundColor"
                        [style.color]="chip?.foregroundColor">{{
                        chip?.value
                        }}</span>
                    </span>
                  </ng-container>
                  <!-- Add more header types as needed -->
                </ng-container>
              </div>

              <!-- Body -->
              <div class="task-body" [innerHTML]="task.body?.summary"
                [attr.contenteditable]="task.body?.summary?.contenteditable">
              </div>

              <!-- Footer -->
              <div class="task-footer" *ngIf="task.footer?.length">
                <ng-container *ngFor="let item of task.footer">
                  <div class="avatar" *ngIf="item.type === 'avatar'">
                    <img *ngIf="item?.photo" [src]="item?.photo" alt="{{ item.label }}" />
                    <span>{{ item.label }}</span>
                  </div>
                  <ng-container *ngIf="item.type === 'budget'">
                    <div>Budget: {{ item.value }}</div>
                  </ng-container>
                  <ng-container *ngIf="item.type === 'timeFrame'">
                    <div>Time Frame: {{ item.value }}</div>
                  </ng-container>
                  <!-- Add more footer types as needed -->
                </ng-container>
              </div>
            </div>
          </div>
        </div>

        <div class="kanban-column-action" *ngIf="column?.action && !column?.collapsed">
          <a class="add-button" (click)="addAction($event, column)">{{ column?.action?.label }}</a>
        </div>
      </div>
    </div>
  </ng-container>
</div>

<!-- Swimlane -->
<ng-container *ngIf="type === 'swimlane'">
  <div class="kanban-board">
    <ng-container *ngFor="let column of data[0] | columnNames: data">
      <div [style.width.%]="column?.idealWidth" class="kanban-column">
        <div class="kanban-column-header">
          <h2 [class.collapsed]="column?.collapsed">
            <span *ngIf="!column?.collapsed">{{ column.heading }}</span>

            <span class="expand-icon" *ngIf="column?.toggleColumn" [class.icon_center]="column?.collapsed"
              (click)="toggleCollapseSwimlane(column)">
              <!-- Custom symbols for expand and collapse -->
              <ng-container *ngIf="!column?.collapsed; else collapsedIcon">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                  fill="#5f6368">
                  <path d="M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z" />
                </svg>
              </ng-container>
              <ng-template #collapsedIcon>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                  fill="#5f6368">
                  <path d="m321-80-71-71 329-329-329-329 71-71 400 400L321-80Z" />
                </svg>
              </ng-template>
            </span>
          </h2>
        </div>
      </div>
    </ng-container>
  </div>

  <section cdkDropListGroup class="swimlane-section">
    <details open *ngFor="let column of data">
      <summary>{{ column?.heading }}</summary>

      <div class="kanban-board">
        <div class="kanban-column-data" *ngFor="let dataColumn of column.columns"
          [style.width.%]="dataColumn?.idealWidth" [class.padding_0]="dataColumn?.collapsed">
          <div *ngIf="dataColumn?.collapsed" class="vertical-writing">
            [{{dataColumn.tasks?.length}}] {{dataColumn.heading}}
          </div>

          <div cdkDropList [cdkDropListData]="dataColumn.tasks" class="kanban-list"
            attr.customId="swimlane_row_{{column?.id}}" #kanbanList (cdkDropListDropped)="drop($event)"
            *ngIf="!dataColumn?.collapsed">
            <div class="kanban-item" *ngFor="let task of dataColumn.tasks" cdkDrag
              [style.borderTop]="task?.borderColor ? '3px solid ' + task?.borderColor : ''">
              <div class="task-card">
                <!-- Header -->
                <div class="task-header" *ngIf="task?.header?.length">
                  <ng-container *ngFor="let item of task.header">
                    <ng-container *ngIf="item.type === 'link'">
                      <span class="link">
                        <a href="javascript:void(0)" (click)="addAction($event, item)">{{ item.label }}</a>
                      </span>
                    </ng-container>
                    <ng-container *ngIf="item.type === 'chip'">
                      <span class="chip-container">
                        <span *ngFor="let chip of item.value" class="chip"
                          [style.backgroundColor]="chip?.backgroundColor" [style.color]="chip?.foregroundColor">{{
                          chip?.value
                          }}</span>
                      </span>
                    </ng-container>
                    <!-- Add more header types as needed -->
                  </ng-container>
                </div>

                <!-- Body -->
                <div class="task-body" [innerHTML]="task.body?.summary"
                  [attr.contenteditable]="task.body?.summary?.contenteditable">
                </div>

                <!-- Footer -->
                <div class="task-footer" *ngIf="task.footer?.length">
                  <ng-container *ngFor="let item of task.footer">
                    <div class="avatar" *ngIf="item.type === 'avatar'">
                      <img *ngIf="item?.photo" [src]="item?.photo" alt="{{ item.label }}" />
                      <span>{{ item.label }}</span>
                    </div>
                    <ng-container *ngIf="item.type === 'budget'">
                      <div>Budget: {{ item.value }}</div>
                    </ng-container>
                    <ng-container *ngIf="item.type === 'timeFrame'">
                      <div>Time Frame: {{ item.value }}</div>
                    </ng-container>
                    <!-- Add more footer types as needed -->
                  </ng-container>
                </div>
              </div>
            </div>
          </div>

          <div class="kanban-column-action" *ngIf="column?.action && !column?.collapsed">
            <a class="add-button" (click)="addAction($event, column)">{{ column?.action?.label }}</a>
          </div>
        </div>
      </div>
    </details>
  </section>
</ng-container>

<!-- Workflow  -->
<ng-container *ngIf="type === 'workflow'">
  <table>
    <thead>
      <tr>
        <th *ngFor="let th of tableHeaders; let i=index" [style.width.%]="100 / tableHeaders.length">
          <span class="workflow-table-heading">{{ th.label }}</span>

          <svg class="add-next" width="32" height="32" viewBox="0 0 32 32" fill="none"
            xmlns="http://www.w3.org/2000/svg" (click)="addAction($event, th)">
            <rect width="32" height="32" rx="4" fill="#F8F6FE" />
            <path
              d="M16 20.6664C15.8112 20.6664 15.6472 20.5971 15.508 20.4584C15.3694 20.3192 15.3 20.1552 15.3 19.9664V16.7H12.0336C11.8448 16.7 11.6808 16.6307 11.5416 16.492C11.403 16.3528 11.3336 16.1888 11.3336 16C11.3336 15.8112 11.403 15.6472 11.5416 15.508C11.6808 15.3693 11.8448 15.3 12.0336 15.3H15.3V12.0336C15.3 11.8448 15.3694 11.6808 15.508 11.5416C15.6472 11.4029 15.8112 11.3336 16 11.3336C16.1888 11.3336 16.3528 11.4029 16.492 11.5416C16.6307 11.6808 16.7 11.8448 16.7 12.0336V15.3H19.9664C20.1552 15.3 20.3192 15.3693 20.4584 15.508C20.5971 15.6472 20.6664 15.8112 20.6664 16C20.6664 16.1888 20.5971 16.3528 20.4584 16.492C20.3192 16.6307 20.1552 16.7 19.9664 16.7H16.7V19.9664C16.7 20.1552 16.6307 20.3192 16.492 20.4584C16.3528 20.5971 16.1888 20.6664 16 20.6664Z"
              fill="#573DF4" />
          </svg>

        </th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let opportunity of data; let i = index">
        <tr *ngIf="opportunity.solutions.length > 0; else noSolutions">
          <!-- First column for opportunity details -->
          <td [attr.rowspan]="opportunity.solutions.length + 1" class="odd-section">
            <div class="kanban-item" *ngIf="!(opportunity.opportunity | isEmptyObject)"
              [style.borderTop]="opportunity.opportunity?.borderColor ? '3px solid ' + opportunity.opportunity?.borderColor : ''">
              <div class="task-card">
                <!-- Header -->
                <div class="task-header" *ngIf="opportunity.opportunity.header?.length">
                  <ng-container *ngFor="let item of opportunity.opportunity.header">
                    <ng-container *ngIf="item.type === 'link'">
                      <span class="link">
                        <a href="javascript:void(0)" (click)="addAction($event, item)">{{ item.label }}</a>
                      </span>
                    </ng-container>
                    <ng-container *ngIf="item.type === 'chip'">
                      <span class="chip-container">
                        <span *ngFor="let chip of item.value" class="chip"
                          [style.backgroundColor]="chip?.backgroundColor" [style.color]="chip?.foregroundColor">
                          {{ chip?.value }}
                        </span>
                      </span>
                    </ng-container>
                    <!-- Add more header types as needed -->
                  </ng-container>
                </div>

                <!-- Body -->
                <div class="task-body" *ngIf="opportunity.opportunity.body?.summary"
                  [innerHTML]="opportunity.opportunity.body?.summary"
                  [attr.contenteditable]="opportunity.opportunity.body?.contenteditable">
                </div>

                <!-- Footer -->
                <div class="task-footer" *ngIf="opportunity.opportunity.footer?.length">
                  <ng-container *ngFor="let item of opportunity.opportunity.footer">
                    <div class="avatar" *ngIf="item.type === 'avatar'">
                      <img *ngIf="item?.photo" [src]="item?.photo" alt="{{ item.label }}" />
                      <span>{{ item.label }}</span>
                    </div>
                    <ng-container *ngIf="item.type === 'budget'">
                      <div>Budget: {{ item.value }}</div>
                    </ng-container>
                    <ng-container *ngIf="item.type === 'timeFrame'">
                      <div>Time Frame: {{ item.value }}</div>
                    </ng-container>
                    <!-- Add more footer types as needed -->
                  </ng-container>
                </div>
              </div>
            </div>
            <div *ngIf="opportunity.opportunity?.action" class="workflow-kanban-action">
              <a (click)="addAction($event, opportunity.opportunity)" class="d-flex">
                <span *ngIf="opportunity.opportunity?.action?.icon"
                  [innerHTML]="sanitizer.bypassSecurityTrustHtml(opportunity.opportunity?.action?.icon)"></span>
                <span class="add_solution_button">{{ opportunity.opportunity?.action?.label }}</span>
              </a>
            </div>
          </td>
        </tr>

        <!-- Rows for each solution and its experiments -->
        <ng-container *ngFor="let solution of opportunity.solutions; let j = index">
          <tr>
            <!-- Solution column -->
            <td>
              <div class="kanban-item" *ngIf="!(solution.solution | isEmptyObject)"
                [style.borderTop]="solution.solution?.borderColor ? '3px solid ' + solution.solution?.borderColor : ''">
                <div class="task-card">
                  <!-- Header -->
                  <div class="task-header" *ngIf="solution.solution.header?.length">
                    <ng-container *ngFor="let item of solution.solution.header">
                      <ng-container *ngIf="item.type === 'link'">
                        <span class="link">
                          <a href="javascript:void(0)" (click)="addAction($event, item)">{{ item.label }}</a>
                        </span>
                      </ng-container>
                      <ng-container *ngIf="item.type === 'chip'">
                        <span class="chip-container">
                          <span *ngFor="let chip of item.value" class="chip"
                            [style.backgroundColor]="chip?.backgroundColor" [style.color]="chip?.foregroundColor">
                            {{ chip?.value }}
                          </span>
                        </span>
                      </ng-container>
                      <!-- Add more header types as needed -->
                    </ng-container>
                  </div>

                  <!-- Body -->
                  <div class="task-body" *ngIf="solution.solution.body?.summary"
                    [innerHTML]="solution.solution.body?.summary"
                    [attr.contenteditable]="solution.solution.body?.contenteditable">
                  </div>

                  <!-- Footer -->
                  <div class="task-footer" *ngIf="solution.solution.footer?.length">
                    <ng-container *ngFor="let item of solution.solution.footer">
                      <div class="avatar" *ngIf="item.type === 'avatar'">
                        <img *ngIf="item?.photo" [src]="item?.photo" alt="{{ item.label }}" />
                        <span>{{ item.label }}</span>
                      </div>
                      <ng-container *ngIf="item.type === 'budget'">
                        <div>Budget: {{ item.value }}</div>
                      </ng-container>
                      <ng-container *ngIf="item.type === 'timeFrame'">
                        <div>Time Frame: {{ item.value }}</div>
                      </ng-container>
                      <!-- Add more footer types as needed -->
                    </ng-container>
                  </div>
                </div>
              </div>
              <div *ngIf="solution.solution?.action" class="workflow-kanban-action">
                <a (click)="addAction($event, solution.solution)" class="d-flex">
                  <span *ngIf="solution.solution?.action?.icon"
                    [innerHTML]="sanitizer.bypassSecurityTrustHtml(solution.solution?.action?.icon)"></span>
                  <span class="add_solution_button">{{ solution.solution?.action?.label }}</span>
                </a>
              </div>
            </td>

            <!-- Experiments column -->
            <td class="odd-section" cdkDropListGroup cdkDropList [cdkDropListData]="solution.experiments"
              (cdkDropListDropped)="drop($event)">
              <ng-container *ngFor="let experiment of solution.experiments" class="kanban-list">
                <div class="kanban-item" cdkDrag
                  [style.borderTop]="experiment?.borderColor ? '3px solid ' + experiment?.borderColor : ''">
                  <div class="task-card">
                    <!-- Header -->
                    <div class="task-header" *ngIf="experiment.header?.length">
                      <ng-container *ngFor="let item of experiment.header">
                        <ng-container *ngIf="item.type === 'link'">
                          <span class="link">
                            <a href="javascript:void(0)" (click)="addAction($event, item)">{{ item.label }}</a>
                          </span>
                        </ng-container>
                        <ng-container *ngIf="item.type === 'chip'">
                          <span class="chip-container">
                            <span *ngFor="let chip of item.value" class="chip"
                              [style.backgroundColor]="chip?.backgroundColor" [style.color]="chip?.foregroundColor">
                              {{ chip?.value }}
                            </span>
                          </span>
                        </ng-container>
                        <!-- Add more header types as needed -->
                      </ng-container>
                    </div>

                    <!-- Body -->
                    <div class="task-body" *ngIf="experiment.body?.summary" [innerHTML]="experiment.body?.summary"
                      [attr.contenteditable]="experiment.body?.contenteditable">
                    </div>

                    <!-- Footer -->
                    <div class="task-footer" *ngIf="experiment.footer?.length">
                      <ng-container *ngFor="let item of experiment.footer">
                        <div class="avatar" *ngIf="item.type === 'avatar'">
                          <img *ngIf="item?.photo" [src]="item?.photo" alt="{{ item.label }}" />
                          <span>{{ item.label }}</span>
                        </div>
                        <ng-container *ngIf="item.type === 'budget'">
                          <div>Budget: {{ item.value }}</div>
                        </ng-container>
                        <ng-container *ngIf="item.type === 'timeFrame'">
                          <div>Time Frame: {{ item.value }}</div>
                        </ng-container>
                        <!-- Add more footer types as needed -->
                      </ng-container>
                    </div>
                  </div>
                </div>
              </ng-container>
            </td>
          </tr>
        </ng-container>

        <!-- Placeholder row if no solutions -->
        <ng-template #noSolutions>
          <tr>
            <td class="odd-section">
              <div class="kanban-item" *ngIf="!(opportunity.opportunity | isEmptyObject)"
                [style.borderTop]="opportunity.opportunity?.borderColor ? '3px solid ' + opportunity.opportunity?.borderColor : ''">
                <div class="task-card">
                  <!-- Header -->
                  <div class="task-header" *ngIf="opportunity.opportunity.header?.length">
                    <ng-container *ngFor="let item of opportunity.opportunity.header">
                      <ng-container *ngIf="item.type === 'link'">
                        <span class="link">
                          <a href="javascript:void(0)" (click)="addAction($event, item)">{{ item.label }}</a>
                        </span>
                      </ng-container>
                      <ng-container *ngIf="item.type === 'chip'">
                        <span class="chip-container">
                          <span *ngFor="let chip of item.value" class="chip"
                            [style.backgroundColor]="chip?.backgroundColor" [style.color]="chip?.foregroundColor">
                            {{ chip?.value }}
                          </span>
                        </span>
                      </ng-container>
                      <!-- Add more header types as needed -->
                    </ng-container>
                  </div>

                  <!-- Body -->
                  <div class="task-body" *ngIf="opportunity.opportunity.body?.summary"
                    [innerHTML]="opportunity.opportunity.body?.summary"
                    [attr.contenteditable]="opportunity.opportunity.body?.contenteditable">
                  </div>

                  <!-- Footer -->
                  <div class="task-footer" *ngIf="opportunity.opportunity.footer?.length">
                    <ng-container *ngFor="let item of opportunity.opportunity.footer">
                      <div class="avatar" *ngIf="item.type === 'avatar'">
                        <img *ngIf="item?.photo" [src]="item?.photo" alt="{{ item.label }}" />
                        <span>{{ item.label }}</span>
                      </div>
                      <ng-container *ngIf="item.type === 'budget'">
                        <div>Budget: {{ item.value }}</div>
                      </ng-container>
                      <ng-container *ngIf="item.type === 'timeFrame'">
                        <div>Time Frame: {{ item.value }}</div>
                      </ng-container>
                      <!-- Add more footer types as needed -->
                    </ng-container>
                  </div>
                </div>
              </div>
              <div *ngIf="opportunity.opportunity?.action" class="workflow-kanban-action">
                <a (click)="addAction($event, opportunity.opportunity)" class="d-flex">
                  <span *ngIf="opportunity.opportunity?.action?.icon"
                    [innerHTML]="sanitizer.bypassSecurityTrustHtml(opportunity.opportunity?.action?.icon)"></span>
                  <span class="add_solution_button">{{ opportunity.opportunity?.action?.label }}</span>
                </a>
              </div>
            </td>
            <td></td>
            <td class="odd-section"></td>
          </tr>
        </ng-template>
      </ng-container>
    </tbody>
  </table>
</ng-container>